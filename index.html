<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LF Phase-shift Test</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
    <h1>Low Frequency Phase-shift Test</h1>

    <div class="bordered">
        <h3>Common Settings</h3>
        <div class="slider-container">
            <label for="freq">Frequency:</label>
            <input type="range" id="freq" name="freq" min="20" max="200" step="1" value="50">
            <span id="freq-value">50Hz</span>
        </div>

        
        <h4>Harmonic Series</h4>
        <div class="slider-container">
            <label for="even">Even Level:</label>
            <input type="range" id="even" name="even" min="-1" max="1" step="0.1" value="-1">
            <span id="even-value">-1</span>
        </div>
        <div class="slider-container">
            <label for="evenFalloff">Even Fall off:</label>
            <input type="range" id="evenFalloff" name="even" min="1" max="2" step="0.1" value="1.7">
            <span id="evenFalloff-value">1/n^1.7</span>
        </div>

        <div class="slider-container">
            <label for="odd">Odd Level:</label>
            <input type="range" id="odd" name="odd" min="-1" max="1" step="0.1" value="1">
            <span id="odd-value">1</span>
        </div>
        <div class="slider-container">
            <label for="oddFalloff">Odd Fall off:</label>
            <input type="range" id="oddFalloff" name="even" min="1" max="2" step="0.1" value="1.7">
            <span id="oddFalloff-value">1/n^1.7</span>
        </div>

        <h4>Envelope</h4>
        <div class="slider-container">
            <label for="attack">Attack:</label>
            <input type="range" id="attack" name="attack" min="0.001" max="0.2" step="0.001" value="0.005">
            <span id="attack-value">0.005s</span>
        </div>

        <div class="slider-container">
            <label for="decay">Decay:</label>
            <input type="range" id="decay" name="decay" min="0.01" max="2" step="0.01" value="0.4">
            <span id="decay-value">0.4s</span>
        </div>

        <div class="slider-container">
            <label for="envelopeFilter">Smoothing:</label>
            <input type="range" id="envelopeFilter" name="envelopeFilter" min="1" max="64" step="1" value="32">
            <span id="envelopeFilter-value">32</span>
        </div>


        <h4>2nd harmonic shift</h4>
        <div class="slider-container">
            <label for="second">Relative Phase delay:</label>
            <input type="range" id="second" name="second" min="0" max="1" step="0.1" value="0.5">
            <span id="second-value">0.5</span>
        </div>
    </div>

    <div class="bordered">
        <h3>Sound A</h3>
        <div>
            <canvas id="waveformA" width ="800" height="200"></canvas>
        </div>
        <div class="slider-container">
            <label for="rootPhaseDelayA">Root Phase Shift:</label>
            <input type="range" id="rootPhaseDelayA" name="rootPhaseDelayA" min="-1.5" max="1.5" step="0.01" value="0">
            <span id="rootPhaseDelayA-value">0π (0ms)</span>
        </div>
        <button id="playSoundA">Play A</button>
    </div>



    <div class="bordered">
        <h3>Sound B</h3>
        <div>
            <canvas id="waveformB"  width ="800" height="200"></canvas>
        </div>
        <div class="slider-container">
            <label for="rootPhaseDelayB">Root Phase Shift:</label>
            <input type="range" id="rootPhaseDelayB" name="rootPhaseDelayB" min="-1.5" max="1.5" step="0.01" value="0.25">
            <span id="rootPhaseDelayB-value">0.25π (10.0ms)</span>
        </div>
        <button id="playSoundB">Play B</button>
    </div>

    <br>


    <div id="centerContainer">
        <div id="abxTestContainer">
            <h3>ABX test</h3>
            <ol id="results"></ol>
            <button id="abxTest" class="testCenter">Test</button>
            <div id="abxButtons"  style="display: none;">
                <button id="buttonA">X is A</button>
                <button id="play">Play X</button>
                <button id="buttonB">X is B</button>
            </div>
            <p id="stats" class="testCenter"></p>
            <br>
            <button id="resetTest"  class="testCenter" style="display: none;">Reset Test</button>
        </div>
    </div>
    <div class="bordered">
        <h3>What is it doing?</h3>
        <p>It generates two sounds with the identical harmonic content and envelope as set by the common controls.</p>
        <p>Each sound has the phase of the fundamental shifted by the specified amount relative to the other harmonics. The second harmonic can also have its phase shifted by a specified fraction of the fundamental shift.</p>
        <p>An envelope with linear attack and exponential decay is applied to each harmonic. The envelope is band limited by an adjustable low-pass filter. </p>
        <p>The envelopes of the first and second harmonics are delayed by the same amount as the phase delay for that harmonic (this may not be the best realistic behaviour?).</p>
        
        
    </div>

    <script src="audio.js"></script>
</body>
</html>