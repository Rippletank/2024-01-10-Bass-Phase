<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sound Quality ABX Tests</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
    <h1>Sound Quality ABX Tests</h1>


    <datalist id="ticksPlus1ZeroMinus1">
        <option value="-1">
        <option value="0">
        <option value="1">
    </datalist>

    <datalist id="ticksPlus2ZeroMinus2">
        <option value="-2">
        <option value="-1.5">
        <option value="-1" label="-π">
        <option value="-0.5">
        <option value="0"  label="0">
        <option value="0.5">
        <option value="1"  label="π">
        <option value="1.5">
        <option value="2">
    </datalist>




    <datalist id="ticksPlus1Zero">
        <option value="0">
        <option value="1">
    </datalist>

    

    <datalist id="ticksZero">
        <option value="0">
    </datalist>
    <datalist id="ticks0half1">
        <option value="0">
        <option value="0.5">
        <option value="1">
    </datalist>

    <!--**********************************************************************-->
    <!--*****************  Start ABX Setup and Test  *************************-->
    <!--**********************************************************************-->

    <div class="bordered">
        <h3>Sound A</h3>
        <div class="canvasBox">
            <canvas id="waveformA"  class="waveformCanvas fullwave" width ="2000" height="500"></canvas>
        </div>
        <div class="testSoundControls" id="SoundASetup">
            <h3 class="stereoLabel hideForMono">Left:</h3>
        </div>
        <div class="testSoundControls hideForMono" id="SoundARSetup">
            <h3 class="stereoLabel hideForMono">Right:</h3>
        </div>
        <button class="playSoundA PlayA">Play A</button>
    </div>



    <div class="bordered">
        <h3>Sound B</h3>
        <div class="canvasBox">
            <canvas id="waveformB"  class="waveformCanvas fullwave" width ="2000" height="500"></canvas>
        </div>
        <div class="testSoundControls" id="SoundBSetup">
            <h3 class="stereoLabel hideForMono">Left:</h3>
        </div>
        <div class="testSoundControls hideForMono" id="SoundBRSetup">
            <h3 class="stereoLabel hideForMono">Right:</h3>
        </div>
        <button class="playSoundB PlayB">Play B</button>
    </div>

    <br>


    <div id="centerContainer">
        <div id="abxTestContainer">
            <h3>ABX test</h3>
            <ol id="results"></ol>
            <button id="abxTest" class="testCenter">Test</button>
            <div id="abxButtons"  style="display: none;">
                <button id="buttonA">X is A</button>
                <button id="play">Play X</button>
                <button id="buttonB">X is B</button>
            </div>
            <p id="stats" class="testCenter"></p>
            <br>
            <button id="resetTest"  class="testCenter" style="display: none;">Reset Test</button>
        </div>
    </div>
    <div class="bordered">
        <div class="presetHeader">
            <h3>Setup </h3>
            <div class="PresetButtons"></div>
            <span class="help-icon">?</span>
            <div class="help-popup">
                Turn on Stereo to investigate how differences between the sounds reaching each ear are perceived. You can also load and save set ups (patches) to share or repeat later. There are a few example patches to fetch and try out.
                
                <p><a href="#Notes1">Background info and explanations</a> </p>
            </div>
        </div>
        <div class ="previewButtons">
            <div class="previewButtons previewL">
                <button name="sStereo" class = "previewButton">Stereo</button>
            </div>
            <div class="previewButtons previewC">
                <button name="xSave" class = "previewButton showDown">save</button>
                <button name="xLoad" class = "previewButton showDown">load</button>
                <button name="xCopy" class = "previewButton showDown">copy</button>
                <button name="xPaste" class = "previewButton showDown">paste</button>
            </div>
            <div class="previewButtons">
                <button name="wShowF" class = "previewButton">Filter overlays</button>
                <button name="wShowEG" class = "previewButton">Envelope overlays</button>
            </div>
        </div>
        <div class ="previewButtons">
            <div class="previewButtons previewL">
                <p>Normalise:</p>
                <button name="NormLoudest" class = "previewButton">Together</button>
                <button name="NormIndy" class = "previewButton">Individually</button>
            </div>
            <div class="previewButtons previewC">
            </div>
            <div class="previewButtons">
            </div>
        </div>
        <div class ="previewButtons spaceTop">
            <div class="previewButtons previewL">
            </div>
            <div class="previewButtons previewC">
                <select id="serverPresetList" title="Select Preset (Server)"></select>
            </div>
            <div class="previewButtons">
            </div>
        </div>
    </div>
    <div class="bordered">
        <div class ="previewButtons">
            <div class="previewButtons"> 
                <label for="notesEdit"></label>
                <textarea id="notesEdit" placeholder="Patch notes"></textarea>
            </div>
        </div>
    </div>

    <!--**********************************************************************-->
    <!--*******************  End ABX Setup and Test  *************************-->
    <!--**********************************************************************-->
    
    

    <div class="bordered" id="CommonSettings">
        <h3>Sound Settings</h3>
        <div class="slider-container">
            <label for="freq">Frequency:</label>
            <input type="range" id="freq" name="frequency" min="20" max="2000" step="1" value="50">
            <output  class="valueSpan" name="frequency">50Hz</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Frequency of first harmonic (fundamental)</div>
        </div>
        <div class="slider-container">
            <label for="freqFine">Frequency (fine):</label>
            <input type="range" id="freqFine" name="frequencyFine" min="-5" max="5" step="0.01" value="0">
            <output  class="valueSpan" name="frequencyFine">0Hz</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Fine adjust for frequency</div>
        </div>

        
        <div class="presetHeader topSpaced">
            <h4>Additive Synthesis</h4>
            <div id="wavePresetButtons" class="PresetButtons"></div>
            <span class="help-icon">?</span>
            <div class="help-popup">Additive synthesis of the basic tone, so basically, building it from sine-waves. The preview shows a single cycle of the wave, the harmonics and phases used are shown in the graph (this is not an FFT).
            </div>
        </div>
        <div class="slider-container">
            <label for="balance">Balance (1st↔higher):</label>
            <input type="range" id="balance" name="balance" min="-1" max="1" step="0.001" value="0" list="ticksPlus1ZeroMinus1">
            <output class="valueSpan" name="balance">same</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Controls the balance between the first harmonic and the others.</div>
        </div>
        <div class="slider-container">
            <label for="even">Even Level:</label>
            <input type="range" id="even" name="evenLevel" min="-1" max="1" step="0.1" value="-1" class="mid-slider" list="ticksPlus1ZeroMinus1">
            <label for="evenAlt"  class="flipLabel">Alt Amt:</label>
            <input type="range" id="evenAlt" name="evenAlt" min="0" max="1" step="0.1" value="0" class="short-slider" list="ticksPlus1Zero">
            <output class="valueSpan" name="even">-1</output>
            <span class="help-icon">?</span>
            <div class="help-popup">First slider controls the level and polarity of the harmonics. The second slider controls how much the polarity alternates, full on will alternate polarity for each harmonic added. </div>
        </div>
        <div class="slider-container">
            <label for="evenFalloff">Even Fall off:</label>
            <input type="range" id="evenFalloff" name="evenFalloff" min="1" max="2" step="0.1" value="1.8">
            <output class="valueSpan" name="evenFalloff">1/n<sup>1.8</sup></output>
            <span class="help-icon">?</span>
            <div class="help-popup">Controls how loud higher harmonics are. For even harmonics, 1/n is typical of sawtooth waves.</div>
        </div>

        <div class="slider-container">
            <label for="odd">Odd Level:</label>
            <input type="range" id="odd" name="oddLevel" min="-1" max="1" step="0.1" value="1" class="mid-slider" list="ticksPlus1ZeroMinus1">
            <label for="oddAlt"  class="flipLabel">Alt Amt:</label>
            <input type="range" id="oddAlt" name="oddAlt" min="0" max="1" step="0.1" value="0" class="short-slider" list="ticksPlus1Zero">
            <output class="valueSpan" name="odd">1</output>
            <span class="help-icon">?</span>
            <div class="help-popup">First slider controls the level and polarity of the harmonics. The second slider controls how much the polarity alternates, full on will alternate polarity for each harmonic added. </div>
        </div>
        <div class="slider-container">
            <label for="oddFalloff">Odd Fall off:</label>
            <input type="range" id="oddFalloff" name="oddFalloff" min="1" max="2" step="0.1" value="1.8">
            <output class="valueSpan" name="oddFalloff">1/n<sup>1.8</sup></output>
            <span class="help-icon">?</span>
            <div class="help-popup">Controls how loud higher harmonics are. For odd harmonics, 1/n is typical of square and sawtooth waves, 1/n^2 is like a triangle wave.</div>
        </div>
        <div class="slider-container">
            <label for="SineToCos">Phase at t=0</label>
            <input type="range" id="SineToCos" name="sinCos" min="-1" max="1" step="0.1" value="0" class="longish-slider" list="ticksPlus1ZeroMinus1">
            <output class="valueSpan longOut" name="sinCos">0</output>
            <span class="help-icon">?</span>
            <div class="help-popup">A fixed phase offset for all harmonics, adjust the phase of waves at t=0. Needed for pulse waves</div>
        </div>
        <div class="slider-container">
            <label for="altW">Alternation Freq:</label>
            <input type="range" id="altW" name="altW" min="0" max="1" step="0.05" value="0.5" class="longish-slider" list="ticks0half1">
            <output class="valueSpan longOut" name="altW">0</output>
            <span class="help-icon">?</span>
            <div class="help-popup">How often the polarity alternates as harmonics are added, the polarity. Usually at 2 to when set of harmonics to alternate (eg triangle). Equivalent to the duty cycle when set up for a pulse wave and values other than 2 used.</div>
        </div>
        <div class="slider-container">
            <label for="altOffset">Alternation Offset:</label>
            <input type="range" id="altOffset" name="altOffset" min="-1" max="1" step="0.1" value="0.0" class="longish-slider" list="ticksPlus1ZeroMinus1">
            <output class="valueSpan longOut" name="altOffset">0</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Adjusts where the positive, negative and zero values of the alternations falls. When at zero, with Alternation Freq set to 2, the alternations fall on odd harmonics. Change to +/-1 to fall on even harmonics.</div>
        </div>   
        <div class="slider-container">
            <label for="aliasing">Aliasing:</label>
            <input type="range" id="aliasing" name="aliasing" min="0" max="2" step="0.1" value="0.0" class="longish-slider" list="ticksPlus1Zero">
            <output class="valueSpan longOut" name="aliasing">0</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Continue to add harmonics past the Nyquist limit to create deliberate aliasing. The level of the harmonic takes into account the filter section. It's as if the ADC is after the filter</div>
        </div>      
        <div class="canvasBox">
            <canvas id="wavePreview"  width ="2000" height="500"></canvas>
        </div>
        <div class ="previewButtons">
            <div class="previewButtons previewL">
                <button name="PD" class = "previewButton">def</button>
                <button name="PA" class = "previewButton hideForStereo">A</button>
                <button name="PB" class = "previewButton hideForStereo">B</button>
                <button name="PA" class = "previewButton hideForMono">A-L</button>
                <button name="PAR" class = "previewButton hideForMono">A-R</button>
                <button name="PB" class = "previewButton hideForMono">B-L</button>
                <button name="PBR" class = "previewButton hideForMono">B-R</button>
            </div>
            <div class="previewButtons previewC">
                <button name="F0" class = "previewButton">off</button>
                <button name="F1" class = "previewButton">F1</button>
                <button name="F2" class = "previewButton">F2</button>
                <button name="F3" class = "previewButton">F3</button>
            </div>

            <div class="previewButtons">
                <button name="HFull" class = "previewButton">Full</button>
                <button name="HPhase" class = "previewButton">Φ</button>
                <button name="HPolarity" class = "previewButton">+/-</button>
            </div>
        </div>

        <div class="presetHeader topSpaced">
            <h4>Envelope</h4>
            <div id="envelopPresetButtons" class="PresetButtons"></div>
            <span class="help-icon">?</span>
            <div class="help-popup">The envelope applied to the sound. The whole envelope is smoothed by a low pass filter.</div>
        </div>
        <div class="slider-container">
            <label for="attack">Attack:</label>
            <input type="range" id="attack" name="attack" min="0.001" max="0.2" step="0.001" value="0.005">
            <output class="valueSpan" name="attack">0.005s</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Controls the time for the linear attack part of the envelope</div>
        </div>

        <div class="slider-container">
            <label for="hold">Hold:</label>
            <input type="range" id="hold" name="hold" min="0.00" max="1" step="0.01" value="0.0">
            <output class="valueSpan" name="hold">0s</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Controls the time held at maximum between attack and decay</div>
        </div>

        <div class="slider-container">
            <label for="decay">Decay:</label>
            <input type="range" id="decay" name="decay" min="0.01" max="2" step="0.01" value="0.4">
            <output class="valueSpan" name="decay">0.4s</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Controls the time for the exponential decay part of the envelope to fall to -60db</div>
        </div>

        <div class="slider-container">
            <label for="envelopeFilter">Smoothing:</label>
            <input type="range" id="envelopeFilter" name="envelopeFilter" min="0" max="1000" step="10" value="150">
            <output class="valueSpan" name="envelopeFilter">150</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Controls the cut-off of the low pass filter which smooths the envelope. 0=off, 1000 = very very low cut-off frequency</div>
        </div>
    </div>

    <div class="bordered">
        <div class="fftPlayButtons topSpacedImportant">
            <button class="fftPlayButton PlayA ">Play A</button>
            <button class="fftPlayButton PlayB">Play B</button>
            <button class="fftPlayButton PlayN">Play Null</button>
        </div>
    </div>

    <div class="bordered" id="FilterSetup">
        <div class="presetHeader">
            <h3>Additive Filter</h3>
            <div id="filterPresetButtons" class="PresetButtons"></div>
            <span class="help-icon">?</span>
            <div class="help-popup">This is an additive simulation of a filter using, is it actually just controlling the levels of the sine-waves being added together. There is no phase change introduced, it is intended to help control the frequency content of the sample and vary it over time using the envelope.</div>
        </div>

        <div class="slider-container">
            <label for="filterSlope">Filter Slope</label>
            <input type="range" id="filterSlope" name="filterSlope" min="0" max="96" step="1" value="12" list="ticksZero">
            <output class="valueSpan" name="filterSlope">12db/octave</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Slope of filter after cut-off</div>
        </div>

        <div class="slider-container">
            <label for="filterF1">Frequency f1:</label>
            <input type="range" id="filterF1" name="filterF1" min="0" max="10" step="0.01" value="10">
            <output class="valueSpan" name="filterF1">20000Hz</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Start frequency of filter</div>
        </div>

        <div class="slider-container">
            <label for="filterF2">Frequency f2:</label>
            <input type="range" id="filterF2" name="filterF2" min="0" max="10" step="0.01" value="10">
            <output class="valueSpan" name="filterF2">20000Hz</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Hold (or end of attack) frequency of filter</div>
        </div>

        <div class="slider-container">
            <label for="filterF3">Frequency f3:</label>
            <input type="range" id="filterF3" name="filterF3" min="0" max="10" step="0.01" value="10">
            <output class="valueSpan" name="filterF3">20000Hz</output>
            <span class="help-icon">?</span>
            <div class="help-popup">End frequency of filter</div>
        </div>

        <div class="slider-container">
            <label for="attackF">Attack (f1→f2):</label>
            <input type="range" id="attackF" name="attackF" min="0.001" max="0.2" step="0.001" value="0.005">
            <output class="valueSpan" name="attackF">0.005s</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Controls the time for the linear (in frequency) attack of filter envelope</div>
        </div>

        <div class="slider-container">
            <label for="holdF">Hold (f2):</label>
            <input type="range" id="holdF" name="holdF" min="0.00" max="1" step="0.01" value="0.0">
            <output class="valueSpan" name="holdF">0s</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Controls the time filter held at maximum between attack and decay</div>
        </div>

        <div class="slider-container">
            <label for="decayF">Decay (f2→f3):</label>
            <input type="range" id="decayF" name="decayF" min="0.01" max="2" step="0.01" value="0.4">
            <output class="valueSpan" name="decayF">0.4s</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Controls the time for the linear (in frequency) decay of filter envelope</div>
        </div>

    </div>



    <div class="bordered" id="TestSetup">
        <div class="presetHeader">
            <h3>Additive Phase shifts </h3>
            <div class="PresetButtons"></div>
            <span class="help-icon">?</span>
            <div class="help-popup">Controls how and by how much the phase of the first harmonic is shifted and also if harmonics are shifted, too.</div>
        </div>
        <h4>Root Phase shift</h4>
        <div class="slider-container">
            <label for="rootPhaseDelay">Root Phase Shift:</label>
            <input type="range" id="rootPhaseDelay" name="rootPhaseDelay" min="-2" max="2" step="0.05" value="0" list="ticksPlus2ZeroMinus2">
            <output class="valueSpan" name="rootPhaseDelay">0π (0ms)</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Phase delay of first harmonic for Sound A. Affects 2nd harmonic according to settings in common section.</div>
        </div>

        <h4>Envelope Mode</h4>
        <div class="slider-container">
            <label for="envMode"   class="modeLabel modeLabelLeft">Delay envelope with phase-shift</label>
            <input type="range" id="envMode" name="envMode" min="1" max="2" step="1" value="1" class="short-slider">
            <span   class="modeLabel modeLabelRight">Fixed envelope for all harmonics</span>
            <span class="help-icon">?</span>
            <div class="help-popup">Controls whether the envelope of a each harmonic is shifted so the it starts with phase=0 of the harmonic or if all harmonics start at the same time but with shifted phases</div>
        </div>

        <h4>Higher harmonic shift</h4>
        <div class="slider-container">
            <label for="second">Relative Phase delay:</label>
            <input type="range" id="second" name="higherHarmonicRelativeShift" min="0" max="1" step="0.1" value="0"  list="ticksPlus1Zero">
            <output class="valueSpan" name="higherHarmonicRelativeShift">0</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Controls how much the higher harmonics (if present) are delayed. It is relative to amount of phase delay on the first harmonic. 0 means no delay and 1 means same phase delay as first harmonic.</div>
        </div>

    </div>

 
 

    <div class="bordered" id="DistortionSetup">
        <div class="presetHeader">
            <h3>Distortion Settings</h3>
            <div id="distortionPresets" class="PresetButtons"></div>
            <span class="help-icon">?</span>
            <div class="help-popup">A range of non-linear processes which can be applied to the sound, controls for the quality of oversampling and some inharmonic tones to investigate Intermodulation. The preview is of a single cycle of the distorted waveform and the FFT of this cycle (excluding inharmonic tones).
            </div>
        </div>
     
        <div class="canvasBox">
            <canvas id="distortionPreview"  width ="2000" height="500"></canvas>
        </div>
        <div class ="previewButtons bottomSpaced">
            <div class="previewButtons previewL">
                <button name="PD" class = "previewButton">def</button>
                <button name="PA" class = "previewButton hideForStereo">A</button>
                <button name="PB" class = "previewButton hideForStereo">B</button>
                <button name="PA" class = "previewButton hideForMono">A-L</button>
                <button name="PAR" class = "previewButton hideForMono">A-R</button>
                <button name="PB" class = "previewButton hideForMono">B-L</button>
                <button name="PBR" class = "previewButton hideForMono">B-R</button>
            </div>
            <div class="previewButtons previewC">
                <button name="F0" class = "previewButton">off</button>
                <button name="F1" class = "previewButton">F1</button>
                <button name="F2" class = "previewButton">F2</button>
                <button name="F3" class = "previewButton">F3</button>
            </div>

            <div class="previewButtons">
                <button name="DFull" class = "previewButton">Full</button>
                <button name="DPhase" class = "previewButton">Φ</button>
                <button name="DPolarity" class = "previewButton">+/-</button>
            </div>
        </div>

        <div class="slider-container">
            <label for="distortion"><b>Distortion Level:</b></label>
            <input type="range" id="distortion" name="distortion" min="0" max="1" step="0.01" value="0"  list="ticksPlus1Zero">
            <output class="valueSpan" name="distortion">0%</output>
            <span class="help-icon">?</span>
            <div class="help-popup">
                <p>Turns distortion on and off and controls the overall amount</p>
                <p>Total Harmonic Distortion is measured (using 10 harmonics) for the distortion applied (not including jitter or inharmonics).</p>
            </div>
        </div>
        <div class="slider-container">
            <label for="hyperbolicDistortion">Hyperbolic Asym:</label>
            <input type="range" id="hyperbolicDistortion" name="hyperbolicDistortion" min="-1" max="1" step="0.01" value="0"  list="ticksPlus1ZeroMinus1">
            <output class="valueSpan" name="hyperbolicDistortion">0%</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Asymmetric hyperbolic function for even harmonics</div>
        </div>
        <div class="slider-container">
            <label for="oddDistortion">Odd harmonic:</label>
            <input type="range" id="oddDistortion" name="oddDistortion" min="-1" max="1" step="0.01" value="0"  list="ticksPlus1ZeroMinus1">
            <output class="valueSpan" name="oddDistortion">0%</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Third order Chebyshev polynomial distortion, generating third harmonic for a sine wave</div>
        </div>
        <div class="slider-container">
            <label for="tanhDistortion">Tanh Saturation:</label>
            <input type="range" id="tanhDistortion" name="tanhDistortion" min="0" max="1" step="0.01" value="0"  list="ticksPlus1Zero">
            <output class="valueSpan" name="tanhDistortion">0%</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Tanh distortion, commonly used in Saturation modelling</div>
        </div>
        <div class="slider-container">
            <label for="clipDistortion">Clipping:</label>
            <input type="range" id="clipDistortion" name="clipDistortion" min="0" max="1" step="0.01" value="0"  list="ticksPlus1Zero">
            <output class="valueSpan" name="clipDistortion">0%</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Plain old full hard clipping</div>
        </div>   


        <div class="canvasBox  topSpaced">
            <canvas id="THDGraphCanvas" class ="canvasHalfHeight" width ="2000" height="200"></canvas>
        </div>
        <p class="THDReport paragraphReport"></p>

        <div class="presetHeader">
            <h3>Speaker - Experimental</h3>
            <div id="speakerPresets" class="PresetButtons"></div>
            <span class="help-icon">?</span>
            <div class="help-popup"><p>An experimental and very basic model to provide frequency dependent distortion. </p>
                <p>Uses a Duffing Oscillator model for non-linear speaker forces.</p> </div>
        </div>
        <div class="slider-container">
            <label for="speakerAmount">Speaker Amount:</label>
            <input type="range" id="speakerAmount" name="speakerAmount" min="0" max="1" step="0.01" value="0"  list="ticksPlus1Zero">
            <output class="valueSpan" name="speakerAmount">0%</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Controls the mix of speaker model and bypassed signal.</div>
        </div>    
        <div class="slider-container">
            <label for="speakerMass">Speaker Mass:</label>
            <input type="range" id="speakerMass" name="speakerMass" min="0" max="1" step="0.01" value="0"  list="ticksPlus1Zero">
            <output class="valueSpan" name="speakerMass">0%</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Speaker mass, second derivative coefficient - acceleration of cone</div>
        </div>    
        <div class="slider-container">
            <label for="speakerDamping">Speaker Damping:</label>
            <input type="range" id="speakerDamping" name="speakerDamping" min="0" max="1" step="0.01" value="0"  list="ticksPlus1Zero">
            <output class="valueSpan" name="speakerDamping">0%</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Damping - first derivative coefficient - velocity of cone</div>
        </div>    
        <div class="slider-container">
            <label for="speakerStiffness">Speaker Stiffness:</label>
            <input type="range" id="speakerStiffness" name="speakerStiffness" min="0" max="1" step="0.01" value="0"  list="ticksPlus1Zero">
            <output class="valueSpan" name="speakerStiffness">0%</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Linear coefficient - restorative force of cone - (Hookes Law)</div>
        </div>    
        <div class="slider-container">
            <label for="speakerNonLinearity">Speaker Non-linearity:</label>
            <input type="range" id="speakerNonLinearity" name="speakerNonLinearity" min="0" max="1" step="0.01" value="0"  list="ticksPlus1Zero">
            <output class="valueSpan" name="speakerNonLinearity">0%</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Non-linear coefficient - cubed of displacement - curving of restorative force</div>
        </div>    
        


        <div class="presetHeader topSpaced">
            <h3>Oversampling</h3>
            <div id="oversamplingPresets" class="PresetButtons"></div>
            <span class="help-icon">?</span>
            <div class="help-popup"><p>Controls for oversampling. Only applied when the Distortion Level is on and only affects the distortion processing.</p>
                <p>Oversampling is only carried out once, not individually for each non-linearity as it is applied so aliasing is still possible.</p> </div>
        </div>
        <div class="slider-container">
            <label for="oversampleTimes">Over Factor:</label>
            <input type="range" id="oversampleTimes" name="oversampleTimes" min="0" max="6" step="1" value="2"  list="ticksZero">
            <output class="valueSpan" name="oversampleTimes">x4</output>
            <span class="help-icon">?</span>
            <div class="help-popup">How many times the sample rate is increased for the non-linear processes to be applied</div>
        </div>
        <div class="slider-container">
            <label for="oversampleStopDepth">Stop Band:</label>
            <input type="range" id="oversampleStopDepth" name="oversampleStopDepth" min="0" max="1" step="0.1" value="0.5">
            <output class="valueSpan" name="oversampleStopDepth">90db%</output>
            <span class="help-icon">?</span>
            <div class="help-popup">The amount of cut in the stop-band.</div>
        </div>
        <div class="slider-container">
            <label for="oversampleTransition">Transition Width:</label>
            <input type="range" id="oversampleTransition" name="oversampleTransition" min="0." max="1" step="0.1" value="0.5">
            <output class="valueSpan" name="oversampleTransition">0.1 x fc</output>
            <span class="help-icon">?</span>
            <div class="help-popup">The width of the transition band between pass and stop</div>
        </div>
        <div class="slider-container">
            <label for="ultrasonicFrequency">Ultrasonic Tone:</label>
            <input type="range" id="ultrasonicFrequency" name="ultrasonicFrequency" min="0" max="1" step="0.01" value="0.5" class="mid-slider">
            <label for="ultrasonicLevel"  class="flipLabel">Level:</label>
            <input type="range" id="ultrasonicLevel" name="ultrasonicLevel" min="-91" max="0" step="1" value="-91" class="short-slider" list="ticksPlus1Zero">
            <output class="valueSpan" name="ultrasonic">-1</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Level and frequency of an ultrasonic tone added after upsampling but before distortion to test audibility of intermodulation artifacts. The tones is between sample nyquist and oversampled nyquist so depends on both sample rate and oversampling factor. </div>
        </div>
        <p class="oversamplingReport paragraphReport">Distortion processing off</p>

    
        
        
        <div class="presetHeader">
            <h3>Jitter</h3>
            <div class="PresetButtons"></div>
            <span class="help-icon">?</span>
            <div class="help-popup">
                <p>Simulation of jitter in ADC and/or DAC. Uses 3x oversampling and Lagrange interpolation to get the sample points. </p>
                <p> Difference between ADC and DAC is how the Lagrange interpolation is done:</p> 
                <p> ADC keeps the time values fixed and 'jitters' where the sample is taken.</p> 
                <p> DAC 'jitters' the time of the samples, but resamples at fixed time points.</p> 
                <p> Is there a difference?</p>
                <p>The jitter is normally distributed white noise.</p>
            </div>
        </div>
        <div class="slider-container">
            <label for="jitterADC">Jitter ADC:</label>
            <input type="range" id="jitterADC" name="jitterADC" min="0" max="1" step="0.01" value="0"  list="ticksPlus1Zero">
            <output class="valueSpan" name="jitterADC">0%</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Simulation of jitter on the ADC, where waveform is undistorted but point where sample is taken moves randomly (normal distribution) around the correct position.</div>
        </div>
        <div class="slider-container">
            <label for="jitterDAC">Jitter DAC:</label>
            <input type="range" id="jitterDAC" name="jitterDAC" min="0" max="1" step="0.01" value="0"  list="ticksPlus1Zero">
            <output class="valueSpan" name="jitterDAC">0%</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Simulation of jitter on the DAC, where waveform is distorted as each sample point is shifted randomly (normal distribution) around the correct position.</div>
        </div>
        <div class="slider-container">
            <label for="jitterPeriodic">Jitter periodic:</label>
            <input type="range" id="jitterPeriodic" name="jitterPeriodic" min="0" max="1" step="0.01" value="0"  list="ticksPlus1Zero">
            <output class="valueSpan" name="jitterPeriodic">0%</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Applies a fixed frequency (37Hz prime) jitter to ADC calculations.</div>
        </div>
        <p class="jitterReport paragraphReport">Jitter is off</p>



        <div class="presetHeader">
            <h3>Inharmonics</h3>
            <div id="inharmonicPresets" class="PresetButtons"></div>
            <span class="help-icon">?</span>
            <div class="help-popup">Controls to add audio range sine-wave tones which can be added to investigate intermodulation distortion. The frequency can be unrelated to the main tone or a ratio defined by the different scales.</div>
        </div>
        <div class="slider-container">
            <label for="inharmonicAFrequency">A (Frequency):</label>
            <input type="range" id="inharmonicAFrequency" name="inharmonicAFrequency" min="20" max="2000" step="1" value="1000" class="mid-slider" list="ticksPlus1Zero">
            <label for="inharmonicALevel"  class="flipLabel">Level:</label>
            <input type="range" id="inharmonicALevel" name="inharmonicALevel" min="-91" max="0" step="1" value="-91" class="short-slider" list="ticksPlus1Zero">
            <output class="valueSpan" name="inharmonicA">-1</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Level and frequency of a tone, A, mixed in to the main sound. Frequency set directly. </div>
        </div>
        <div class="slider-container">
            <label for="inharmonicBSemitones">B (Equal Temper.):</label>
            <input type="range" id="inharmonicBSemitones" name="inharmonicBSemitones" min="1" max="11" step="1" value="1" class="mid-slider" list="ticksPlus1ZeroMinus1">
            <label for="inharmonicBLevel"  class="flipLabel">Level:</label>
            <input type="range" id="inharmonicBLevel" name="inharmonicBLevel" min="-91" max="0" step="1" value="-91" class="short-slider" list="ticksPlus1Zero">
            <output class="valueSpan" name="inharmonicB">-1</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Level and pitch of a tone, B, mixed in to the main sound. The pitch is set in semitones according to Equal temperament scale. </div>
        </div>
        <div class="slider-container">
            <label for="inharmonicCSemitones">C (Just Intonation):</label>
            <input type="range" id="inharmonicCSemitones" name="inharmonicCSemitones" min="1" max="11" step="1" value="1" class="mid-slider" list="ticksPlus1ZeroMinus1">
            <label for="inharmonicCLevel"  class="flipLabel">Level:</label>
            <input type="range" id="inharmonicCLevel" name="inharmonicCLevel" min="-91" max="0" step="1" value="-91" class="short-slider" list="ticksPlus1Zero">
            <output class="valueSpan" name="inharmonicC">off</output>
            <span class="help-icon">?</span>
            <div class="help-popup">Level and pitch of a tone, B, mixed in to the main sound. The pitch is set in semitones according to Ptolemy's intense diatonic scale. </div>
        </div>
    </div>

    

    <div class="bordered">
        <div class="presetHeader">
            <h3>Playback FFT</h3>
            <div class="PresetButtons"></div>
            <span class="help-icon">?</span>
            <div class="help-popup">FFT as provided by the Web Audio API, including built in smoothing and windowing functions.</div>
        </div>
        <div class="fftPlayButtons">
            <button class="fftPlayButton PlayA">Play A</button>
            <button class="fftPlayButton PlayB">Play B</button>
            <button class="fftPlayButton PlayN">Play Null</button>
        </div>
        <div class="canvasBox">
            <canvas id="fftCanvas"></canvas>
        </div>
        
        <div class ="previewButtons">
            <div class="previewButtons previewL">
            </div>
            <div class="previewButtons previewC">
            </div>
            <div class="previewButtons">
                <button name="apiFFT" class = "previewButton">On</button>
            </div>
        </div>
    </div>

    <div class="bordered">
        <div class="presetHeader">
            <h3>Static Detailed FFT </h3>
            <div class="PresetButtons"></div>
            <span class="help-icon">?</span>
            <div class="help-popup">Static FFT, updated automatically when waveforms are updated or when update is tapped. 
                The FFT is of a specially built preview which uses the same sound settings as above but is tuned to give a whole number of cycles within the 64k sample frame, hence the spectrum is particularly sharp. 
            Inharmonic tones are added using a windowing function to keep the spectrum as clean as possible.</div>
        </div>
        <div class="canvasBox">
            <canvas id="staticFFTCanvas" width ="2000" height="500"></canvas>
        </div>
        
        <div class ="previewButtons bottomSpaced">
            <div class="previewButtons previewL">
                <button name="PD" class = "previewButton">def</button>
                <button name="PA" class = "previewButton hideForStereo">A</button>
                <button name="PB" class = "previewButton hideForStereo">B</button>
                <button name="PA" class = "previewButton hideForMono">A-L</button>
                <button name="PAR" class = "previewButton hideForMono">A-R</button>
                <button name="PB" class = "previewButton hideForMono">B-L</button>
                <button name="PBR" class = "previewButton hideForMono">B-R</button>
            </div>
            <div class="previewButtons previewC">
                <button name="F0" class = "previewButton">off</button>
                <button name="F1" class = "previewButton">F1</button>
                <button name="F2" class = "previewButton">F2</button>
                <button name="F3" class = "previewButton">F3</button>
            </div>

            <div class="previewButtons">
                <button name="qd120" class = "previewButton">120</button>
                <button name="qd90" class = "previewButton">90</button>
                <button name="qd60" class = "previewButton">60</button>
                <button name="qf-" class = "previewButton">F-</button>
                <button name="qfR" class = "previewButton">R</button>
                <button name="qf+" class = "previewButton">F+</button>
                <button name="qAuto" class = "previewButton">Auto</button>
                <button name="qDo" class = "previewButton showDown">Update</button>
            </div>
        </div>
    </div>
<!-- 

    <div class="bordered">
        <h3>Sound A</h3>
        <div class="canvasBox">
            <canvas id="waveformA"  class="waveformCanvas fullwave" width ="2000" height="500"></canvas>
        </div>
        <div class="testSoundControls" id="SoundASetup">
            <h3 class="stereoLabel hideForMono">Left:</h3>
        </div>
        <div class="testSoundControls hideForMono" id="SoundARSetup">
            <h3 class="stereoLabel hideForMono">Right:</h3>
        </div>
        <button class="playSoundA PlayA">Play A</button>
    </div>



    <div class="bordered">
        <h3>Sound B</h3>
        <div class="canvasBox">
            <canvas id="waveformB"  class="waveformCanvas fullwave" width ="2000" height="500"></canvas>
        </div>
        <div class="testSoundControls" id="SoundBSetup">
            <h3 class="stereoLabel hideForMono">Left:</h3>
        </div>
        <div class="testSoundControls hideForMono" id="SoundBRSetup">
            <h3 class="stereoLabel hideForMono">Right:</h3>
        </div>
        <button class="playSoundB PlayB">Play B</button>
    </div> -->



    <div class="bordered">
        <div class="presetHeader">
            <h3>Null test </h3>
            <h3 class="center"><span id="nullTestdb"></span></h3>
            <span class="help-icon">?</span>
            <div class="help-popup">
                Sound B is inverted and added to Sound B. The level is then measured and result is normalised (assuming it is not completely null). Identifies the differences between the sounds.
                <p>See <a href="#Notes1">explanation of Null Test</a></p>
            </div>
        </div>
                
        <div class="canvasBox">
            <canvas id="waveformNull"  class="fullwave" width ="2000" height="500"></canvas>
        </div>
        <button class="PlayN">Play</button>
    </div>



    <div id="Notes1" class="bordered">
        <h3>Notes: Background</h3>
        <p>This page was created to help investigate audibility of low frequency phase shifts.</p>
        <p>It generates two sounds with identical harmonic content and envelopes as set by the common controls.</p>
        <p>By default, each sound has the phase of the first harmonic shifted by the specified amount relative to the other harmonics. Higher harmonic can also be phase shifted by a specified fraction of the root phase shift.</p>
        <p>The CheckBoxes next to each slider allow those parameters to be selected for testing. They will appear in the Sound A and Sound B boxes allowing them to be independently set for each sound.</p>
        <p>An envelope with linear attack and exponential decay is applied to each harmonic. The envelope is band limited by an adjustable low-pass filter. </p>
        <p>By default, the envelopes of the first (and other if specified) harmonics are delayed by the same amount as the phase delay for that harmonic but this delay can be removed.</p>  
        <p>The waves are normalised together so their relative size are unchanged. This is to keep to optimum loudness levels for tests, avoiding clipping or the sounds being too quiet.</p> 
        <p>Negative phase shifts are there to allow trying to compensate for existing phase shifts in playback systems.</p>
        <p>The code is plain javascript, using the browsers own Web Audio API for playback, to allow for easy modification and review of methodology etc.</p>
        <p>The waves are generated using additive synthesis to allow for easy and predictable setting of phases and levels.</p>
        <p>The filter is a simulated Butterworth response but with no phase shift. It is intended just for altering harmonic content to try out different sounds The filter envelope is linear but moves the frequency as if it were an exponential control.</p>
    </div>
    
    <div id="Notes2" class="bordered">
        <h3>Notes: Null test</h3>
        <p>This null test is a sanity check for the generated waveforms.</p>
        <p>Play back and image of the null test result is of the normalised version. Peak level is measured before any normalising.</p> 
        <p>The null test should only contain the first harmonic (and second if it is shifted, too) plus a little distortion for short attacks and/or low smoothing due to offset attack starts.</p>
        <p>Changes to harmonics controls should not affect the sound of the null test result (with no second harmonic shift).</p>
        <p>With a significant hold time and no second harmonic shift, an offset of pi should and does give 6db and with pi/2 should and does give 3db. With 2Pi, the hold section should and does null, but the offset envelopes will cause a difference to appear during attack and decay.</p>
    </div>
    <script src="defaults.js"></script>
    <script src="basicFFT.js"></script>
    <script src="oversampling.js"></script>
    <script src="speaker.js"></script>
    <script src="distortion.js"></script>
    <script src="jitter.js"></script>
    <script src="audio.js"></script>
    <script src="painting.js"></script>
    <script src="audioAPI.js"></script>
    <script src="guiValues.js"></script>
    <script src="gui.js"></script>
</body>
</html>